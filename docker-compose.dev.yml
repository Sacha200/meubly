services:
  meubly-back:
    profiles:
      - app
    command: sh -c "test -x node_modules/.bin/nodemon || npm ci --include=dev; npm run dev"
    environment:
      NODE_ENV: development
    volumes:
      - ./meubly-back:/app
      - /app/node_modules

  meubly-front:
    profiles:
      - app
    command: sh -c "test -x node_modules/.bin/vite || npm ci --include=dev; npm run dev -- --host 0.0.0.0 --port 5173"
    environment:
      NODE_ENV: development
      VITE_API_BASE_URL: http://localhost:5000/api/v1
      VITE_SUPABASE_URL: http://localhost:8000
      VITE_SUPABASE_ANON_KEY: ${ANON_KEY}
      # Windows/macOS + bind mounts: force polling so Vite invalide bien son cache
      CHOKIDAR_USEPOLLING: "true"
      CHOKIDAR_INTERVAL: "150"
    volumes:
      - ./meubly-front:/app
      - /app/node_modules
