@startuml Diagramme de Classes Am√©lior√© - Meubly

!define RECTANGLE class
!define PACKAGE package

' === STYLES ET COULEURS ===
skinparam class {
    BackgroundColor<<Auth>> LightBlue
    BackgroundColor<<Service>> LightGreen
    BackgroundColor<<Entity>> LightYellow
    BackgroundColor<<External>> LightGray
    BorderColor Black
    FontColor Black
}

' === GROUPE AUTHENTIFICATION ===
package "üîê Authentification" {
    RECTANGLE "Supabase Auth" as SupabaseAuth <<External>> {
        + signInWithPassword()
        + signUp()
        + signOut()
        + getSession()
        + onAuthStateChange()
    }

    RECTANGLE AuthStore <<Auth>> {
        - user: User
        - session: Session
        + init(): void
        + isAuthenticated(): Boolean
        + userEmail(): String
        + userName(): String
    }

    RECTANGLE User <<Entity>> {
        - user_id: String
        - username: String
        - email: String
        - lastname: String
        - role: String
        - created_at: Date
        + register(userData: Object): User
        + login(credentials: Object): Session
        + logout(): void
    }
}

' === GROUPE SERVICES M√âTIER ===
package "üõ†Ô∏è Services M√©tier" {
    RECTANGLE FurnitureService <<Service>> {
        - supabase: SupabaseClient
        + initializeDatabase(): Array<Furniture>
        + getFurnitureById(id: String): Furniture
        + addFurniture(furniture: Object): Furniture
        + updateFurniture(id: String, data: Object): Furniture
        + deleteFurniture(id: String): void
    }

    RECTANGLE SearchService <<Service>> {
        + searchFurniture(query: String): Array<Furniture>
        + filterByCategory(category: String): Array<Furniture>
        + filterByPrice(min: Number, max: Number): Array<Furniture>
    }

    RECTANGLE FavoritesService <<Service>> {
        + addToFavorites(furnitureId: String): void
        + removeFromFavorites(furnitureId: String): void
        + getFavorites(): Array<Furniture>
        + isFavorite(furnitureId: String): Boolean
    }
}

' === GROUPE ENTIT√âS M√âTIER ===
package "üìä Entit√©s M√©tier" {
    RECTANGLE Furniture <<Entity>> {
        - furniture_id: String
        - name: String
        - text: String
        - price: Number
        - cover_url: String
        - nb_offers: Number
        - created_at: Date
        - width: Number
        - height: Number
        - depth: Number
        + getFurnitureById(id: String): Furniture
        + addFurniture(furniture: Object): Furniture
        + initializeDatabase(): Array<Furniture>
    }

    RECTANGLE Offer <<Entity>> {
        - offer_id: String
        - name_furniture: String
        - website: String
        - url_website: String
        - prices: Number
        - furniture_id: String
        + getOffersByFurniture(furnitureId: String): Array<Offer>
        + filterByWebsite(website: String): Array<Offer>
    }

    RECTANGLE Category <<Entity>> {
        - category_id: String
        - title: String
        - cover: String
        - created_at: Date
        - updated_at: Date
        - souscat_id: String
        + getCategories(): Array<Category>
        + getSubcategories(): Array<Category>
    }
}

' === RELATIONS AVEC DISPOSITION AM√âLIOR√âE ===
' Authentification (gauche)
SupabaseAuth -down-> AuthStore : "fournit l'√©tat"
AuthStore -down-> User : "g√®re l'utilisateur"

' Services vers entit√©s (centre)
FurnitureService -right-> Furniture : "g√®re"
SearchService -right-> Furniture : "recherche"
FavoritesService -right-> Furniture : "g√®re les favoris"

' Entit√©s entre elles (droite)
Furniture -down-> Offer : "contient"
Furniture -down-> Category : "appartient √†"
Category -right-> Category : "sous-cat√©gorie"
User -up-> Furniture : "favorise"

' === NOTES AM√âLIOR√âES ===
note top of SupabaseAuth : "üîê Service d'authentification externe"
note top of AuthStore : "üì¶ Store Pinia pour l'√©tat r√©actif"
note top of User : "üë§ Entit√© m√©tier utilisateur"
note top of Furniture : "ü™ë Entit√© m√©tier principale"
note top of FurnitureService : "‚öôÔ∏è Service m√©tier CRUD"
note top of SearchService : "üîç Service de recherche"
note top of FavoritesService : "‚ù§Ô∏è Service de gestion des favoris"

' === L√âGENDE ===
legend right
    |= Couleur |= Type |
    |<back:LightBlue>   </back>| Service d'authentification |
    |<back:LightGreen>   </back>| Service m√©tier |
    |<back:LightYellow>   </back>| Entit√© m√©tier |
    |<back:LightGray>   </back>| Service externe |
endlegend

@enduml 